---
output: github_document
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  cache.path = "cache/README-",
  out.width = "100%")
options(digits = 4)
```
# survTMB

TODO: Write intro to the package...

## Example

TODO: write description

```{r fit_example, cache = 1}
dat <- coxme::eortc

library(survTMB)
library(survival)
fit_model <- function(link, n_threads = 2L){
  adfun <- make_gsm_ADFun(
    Surv(y, uncens) ~ trt, cluster = as.factor(center), 
    Z = ~ trt, df = 3L, data = dat, link = link, do_setup = "Laplace", 
    n_threads = n_threads)
  fit <- do.call(optim, adfun$laplace)
  list(logLik = -fit$value, par = fit$par)
}

fit_model("PH"    )
fit_model("PO"    )
fit_model("probit")
```

```{r comp_time, cache = 1, dependson = "fit_example"}
library(microbenchmark)
microbenchmark(
   PH           = fit_model("PH"    , 1L),
  `PH     (2L)` = fit_model("PH"    , 2L),
  `PH     (4L)` = fit_model("PH"    , 4L),
  
   PO           = fit_model("PO"    , 1L),
  `PO     (2L)` = fit_model("PO"    , 2L),
  `PO     (4L)` = fit_model("PO"    , 4L), 
  
  
   probit       = fit_model("probit", 1L),
  `probit (2L)` = fit_model("probit", 2L),
  `probit (4L)` = fit_model("probit", 4L),
  times = 5)
```
